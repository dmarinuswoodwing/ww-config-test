(this.webpackJsonpmove_to_trashcan_plugin=this.webpackJsonpmove_to_trashcan_plugin||[]).push([[0],{122:function(e,t,n){"use strict";(function(e){var i=n(11),s=n(12),o=n(14),r=n(13),l=n(6),a=n(36),c=n.n(a),d=n(123),u=n(124),h=n(125),v=n(126),f=n(129),b=n(37),p=(n(248),n(0)),g=function(t){Object(o.a)(l,t);var n=Object(r.a)(l);function l(e){var t;return Object(i.a)(this,l),(t=n.call(this,e)).state={page:1,errorCode:0},t}return Object(s.a)(l,[{key:"componentDidMount",value:function(){var e=this;try{this.assetCount=window.elvisContext.activeTab.assetSelection.length,this.folderCount=window.elvisContext.activeTab.folderSelection.filter((function(e){return"/"!==e.name})).length,this.depth=window.elvisContext.activeTab.folderSelection[0].assetPath.split("/").length-1;window.elvisContext.activeTab.folderSelection[0].assetPath.split("/");this.depth<2&&0===this.assetCount&&window.elvisContext.close(),this.assetCount>0?this.setState({page:1}):this.folderCount>0?this.setState({page:2}):window.elvisContext.close();var t=window.elvisContext.activeTab.assetSelection;if(console.log(t),window.elvisContext.plugin.configProperties.global_delete_own_material_only.value&&t.length>0){var n=window.elvisContext.app.userProfile.groups,i=JSON.parse(window.elvisContext.plugin.configProperties.global_groups_allow_delete_non_own.value);if(n.some((function(e){return i.includes(e)})));else{var s=t.map((function(e){return e.metadata.assetCreator}));if(void 0===t[0].metadata.assetCreator)return void setTimeout((function(){e.setState({page:4,errorCode:4})}),0);if(s.find((function(e){return e!=window.elvisContext.app.userProfile.username})))return void setTimeout((function(){e.setState({page:4,errorCode:3})}),0)}}}catch(o){console.log(o),window.elvisContext.close()}}},{key:"onSave",value:function(e){var t,n=this,i=this.state.page;this.setState({page:5});var s={user:window.elvisContext.app.userProfile.username,date:new Date};if(1===i){var o=window.elvisContext.activeTab.assetSelection,r=this.encode(JSON.stringify({ids:o.map((function(e){return{id:e.id,path:e.assetPath}})),metadata:s}),window.elvisContext.plugin.configProperties.key.value);t={index:r.iv,data:r.content}}else if(2===i){var l=window.elvisContext.app.userProfile.groups,a=JSON.parse(window.elvisContext.plugin.configProperties.global_groups_allow_folder_delete.value),c=l.some((function(e){return a.includes(e)}));if(window.elvisContext.plugin.configProperties.preventFolderDelete.value&&!c)return void setTimeout((function(){n.setState({page:4,errorCode:5})}),500);var d=window.elvisContext.activeTab.folderSelection[0].assetPath,u=this.encode(JSON.stringify({folder:d,type:e.folderDeleteType,metadata:s}),window.elvisContext.plugin.configProperties.key.value);t={index:u.iv,data:u.content}}b.a.sendInfo(t).then((function(e){200===e.status?setTimeout((function(){n.setState({page:3})}),500):setTimeout((function(){n.setState({page:4,errorCode:0})}),500)})).catch((function(e){e.response?400===e.response.status?setTimeout((function(){n.setState({page:4,errorCode:1})}),500):setTimeout((function(){n.setState({page:4,errorCode:0})}),500):setTimeout((function(){n.setState({page:4,errorCode:0})}),500)}))}},{key:"toAssetDeleteScreen",value:function(){this.setState({page:1})}},{key:"toFolderDeleteScreen",value:function(){this.setState({page:2})}},{key:"encode",value:function(t,n){var i=c.a.randomBytes(16),s=c.a.createCipheriv("aes-256-ctr",n,i),o=e.concat([s.update(t),s.final()]);return{iv:i.toString("hex"),content:o.toString("hex")}}},{key:"render",value:function(){var e=this.state,t=e.page,n=e.errorCode,i=window.elvisContext.activeTab.assetSelection.length,s=window.elvisContext.activeTab.folderSelection.filter((function(e){return"/"!==e.name})).length;return Object(p.jsxs)(p.Fragment,{children:[1===t?Object(p.jsx)(d.a,{depth:this.depth,assetCount:i,folderCount:s,onSave:this.onSave.bind(this),toFolderDeleteScreen:this.toFolderDeleteScreen.bind(this)}):null,2===t?Object(p.jsx)(u.a,{assetCount:i,folderCount:s,onSave:this.onSave.bind(this),toAssetDeleteScreen:this.toAssetDeleteScreen.bind(this)}):null,3===t?Object(p.jsx)(h.a,{}):null,4===t?Object(p.jsx)(v.a,{error:n}):null,5===t?Object(p.jsx)(f.a,{}):null]})}}]),l}(l.Component);t.a=g}).call(this,n(4).Buffer)},123:function(e,t,n){"use strict";var i=n(11),s=n(12),o=n(14),r=n(13),l=n(6),a=n(0),c=function(e){Object(o.a)(n,e);var t=Object(r.a)(n);function n(e){var s;return Object(i.a)(this,n),(s=t.call(this,e)).text=window.elvisContext.plugin.messages,s.highlightBackgroundColour=window.elvisContext.plugin.configProperties.highlight_background_colour.value,s.highlightTextColour=window.elvisContext.plugin.configProperties.highlight_text_colour.value,s.state={selectedAssetCount:e.assetCount,selectedFolderCount:e.folderCount,confirmed:!1},s}return Object(s.a)(n,[{key:"onConfirmCheckboxChange",value:function(){this.setState({confirmed:!this.state.confirmed})}},{key:"onCancel",value:function(){window.elvisContext.close()}},{key:"onSave",value:function(){this.props.onSave({confirmed:this.state.confirmed})}},{key:"toFolders",value:function(){this.props.toFolderDeleteScreen()}},{key:"gotoRecovery",value:function(){window.open("".concat(window.location.protocol,"//").concat(window.location.host,"/app/#").concat(window.elvisContext.plugin.configProperties.trashcan_plugin_url.value))}},{key:"render",value:function(){var e=this.state,t=e.selectedAssetCount,n=e.selectedFolderCount,i=e.confirmed,s=!i;return Object(a.jsxs)("div",{class:"state-block state-files",children:[Object(a.jsx)("form",{class:"delete-form",children:Object(a.jsxs)("div",{class:"delete-panel",children:[Object(a.jsxs)("div",{class:"delete-main",children:[Object(a.jsx)("h3",{children:this.text.asset_header.replace("{count}",t)}),Object(a.jsx)("input",{className:"pointer",type:"checkbox",id:"confirm-delete",name:"delete-mode",value:"Confirm",checked:i,onChange:this.onConfirmCheckboxChange.bind(this)}),Object(a.jsx)("label",{className:"pointer",for:"confirm-delete",children:this.text.asset_message1}),Object(a.jsx)("br",{}),Object(a.jsxs)("div",{id:"info",class:"delete-info",children:[this.text.asset_message2,Object(a.jsx)("br",{}),this.text.asset_message3]})]}),Object(a.jsxs)("div",{class:"delete-advanced",children:[n>0&&this.props.depth>1?Object(a.jsx)("div",{class:"advanced-link",onClick:this.toFolders.bind(this),children:this.text.asset_message4}):null,Object(a.jsx)("div",{class:"advanced-link",onClick:this.gotoRecovery.bind(this),children:this.text.recovery_message})]}),Object(a.jsxs)("div",{class:"delete-buttons",children:[Object(a.jsx)("button",{type:"button",class:"cancel-btn basic-btn ml10 pale",onClick:this.onCancel,children:this.text.button_cancel}),s?null:Object(a.jsx)("button",{type:"button",class:"start-btn basic-btn ml10",style:{backgroundColor:this.highlightBackgroundColour,border:this.highlightTextColour,color:this.highlightTextColour},onClick:this.onSave.bind(this),children:this.text.button_start}),s?Object(a.jsx)("button",{type:"button",class:"start-btn basic-btn ml10 pale",disabled:!0,children:this.text.button_start}):null]})]})}),Object(a.jsx)("div",{class:"powered-by",children:Object(a.jsxs)("a",{href:"https://evolvedmedia.co.uk",target:"_blank",rel:"noreferrer",alt:"Visit the Evolved Media website",children:[this.text.powered_by," EVOLVED MEDIA"]})})]})}}]),n}(l.Component);t.a=c},124:function(e,t,n){"use strict";var i=n(11),s=n(12),o=n(14),r=n(13),l=n(6),a=n(0),c=function(e){Object(o.a)(n,e);var t=Object(r.a)(n);function n(e){var s;return Object(i.a)(this,n),(s=t.call(this,e)).text=window.elvisContext.plugin.messages,s.highlightBackgroundColour=window.elvisContext.plugin.configProperties.highlight_background_colour.value,s.highlightTextColour=window.elvisContext.plugin.configProperties.highlight_text_colour.value,s.state={deleteType:null},s}return Object(s.a)(n,[{key:"onCancel",value:function(){window.elvisContext.close()}},{key:"onRadioSelectChange",value:function(e){this.setState({deleteType:e.target.value})}},{key:"toAssets",value:function(){this.props.toAssetDeleteScreen()}},{key:"onSave",value:function(){this.props.onSave({folderDeleteType:this.state.deleteType})}},{key:"gotoRecovery",value:function(){window.open("".concat(window.location.protocol,"//").concat(window.location.host,"/app/#").concat(window.elvisContext.plugin.configProperties.trashcan_plugin_url.value))}},{key:"render",value:function(){var e=!this.state.deleteType;return Object(a.jsxs)("div",{class:"state-block state-folders",children:[Object(a.jsx)("form",{class:"delete-form",children:Object(a.jsxs)("div",{class:"delete-panel",children:[Object(a.jsxs)("div",{class:"delete-main",children:[Object(a.jsx)("h3",{children:this.text.folder_header}),Object(a.jsx)("input",{className:"pointer",type:"radio",id:"confirm-this-folder",name:"delete-folders",value:"thisfolder",onChange:this.onRadioSelectChange.bind(this)}),Object(a.jsx)("label",{className:"pointer",for:"confirm-this-folder",children:this.text.folder_message1}),Object(a.jsx)("br",{}),Object(a.jsx)("input",{className:"pointer",type:"radio",id:"confirm-subfolders",name:"delete-folders",value:"subfolders",onChange:this.onRadioSelectChange.bind(this)}),Object(a.jsx)("label",{className:"pointer",for:"confirm-subfolders",children:this.text.folder_message2}),Object(a.jsx)("br",{}),Object(a.jsxs)("div",{id:"info",class:"delete-info",children:[this.text.folder_message3,Object(a.jsx)("br",{}),this.text.folder_message4]})]}),Object(a.jsxs)("div",{class:"delete-advanced",children:[this.props.assetCount>0?Object(a.jsx)("div",{class:"advanced-link",onClick:this.toAssets.bind(this),children:this.text.folder_message5}):null,Object(a.jsx)("div",{class:"advanced-link",onClick:this.gotoRecovery.bind(this),children:this.text.recovery_message})]}),Object(a.jsxs)("div",{class:"delete-buttons",children:[Object(a.jsx)("button",{type:"button",class:"cancel-btn basic-btn ml10 pale",onClick:this.onCancel,children:this.text.button_cancel}),e?null:Object(a.jsx)("button",{type:"button",class:"start-btn basic-btn ml10",style:{backgroundColor:this.highlightBackgroundColour,border:this.highlightTextColour,color:this.highlightTextColour},onClick:this.onSave.bind(this),children:this.text.button_start}),e?Object(a.jsx)("button",{type:"button",class:"start-btn basic-btn ml10 pale",disabled:!0,children:this.text.button_start}):null]})]})}),Object(a.jsx)("div",{class:"powered-by",children:Object(a.jsxs)("a",{href:"https://evolvedmedia.co.uk",target:"_blank",rel:"noreferrer",alt:"Visit the Evolved Media website",children:[this.text.powered_by," EVOLVED MEDIA"]})})]})}}]),n}(l.Component);t.a=c},125:function(e,t,n){"use strict";var i=n(11),s=n(12),o=n(14),r=n(13),l=n(6),a=n(0),c=function(e){Object(o.a)(n,e);var t=Object(r.a)(n);function n(e){var s;return Object(i.a)(this,n),(s=t.call(this,e)).text=window.elvisContext.plugin.messages,s.state={},s}return Object(s.a)(n,[{key:"componentDidMount",value:function(){}},{key:"onCancel",value:function(){window.elvisContext.close()}},{key:"render",value:function(){return Object(a.jsx)("div",{class:"state-block state-running",children:Object(a.jsx)("form",{class:"delete-form",children:Object(a.jsxs)("div",{class:"delete-panel",children:[Object(a.jsxs)("div",{class:"delete-main",children:[Object(a.jsx)("h3",{children:this.text.progress_header}),Object(a.jsxs)("div",{id:"info",class:"delete-info warning",children:[this.text.progress_message1,Object(a.jsx)("br",{}),this.text.progress_message2,Object(a.jsx)("br",{}),Object(a.jsx)("br",{}),this.text.progress_message3]})]}),Object(a.jsx)("div",{class:"delete-buttons",children:Object(a.jsx)("button",{type:"button",class:"cancel-btn basic-btn ml10 pale",onClick:this.onCancel,children:this.text.button_close})})]})})})}}]),n}(l.Component);t.a=c},126:function(e,t,n){"use strict";var i=n(11),s=n(12),o=n(14),r=n(13),l=n(6),a=n(0),c=function(e){Object(o.a)(n,e);var t=Object(r.a)(n);function n(e){var s;return Object(i.a)(this,n),(s=t.call(this,e)).text=window.elvisContext.plugin.messages,s}return Object(s.a)(n,[{key:"componentDidMount",value:function(){}},{key:"onCancel",value:function(){window.elvisContext.close()}},{key:"render",value:function(){return Object(a.jsx)("div",{class:"state-block state-error",children:Object(a.jsx)("form",{class:"delete-form",children:Object(a.jsxs)("div",{class:"delete-panel",children:[Object(a.jsxs)("div",{class:"delete-main",children:[Object(a.jsx)("h3",{children:this.text.error_title}),0===this.props.error?Object(a.jsx)("div",{id:"info",class:"delete-info error",children:this.text.error_message1}):null,1===this.props.error?Object(a.jsx)("div",{id:"info",class:"delete-info error",children:this.text.error_message2}):null,2===this.props.error?Object(a.jsx)("div",{id:"info",class:"delete-info error",children:this.text.error_message3}):null,3===this.props.error?Object(a.jsx)("div",{id:"info",class:"delete-info error",children:this.text.error_message4}):null,4===this.props.error?Object(a.jsx)("div",{id:"info",class:"delete-info error",children:this.text.error_message5}):null,5===this.props.error?Object(a.jsx)("div",{id:"info",class:"delete-info error",children:this.text.error_message6}):null]}),Object(a.jsx)("div",{class:"delete-buttons",children:Object(a.jsx)("button",{type:"button",class:"cancel-btn basic-btn ml10 pale",onClick:this.onCancel,children:this.text.button_close})})]})})})}}]),n}(l.Component);t.a=c},129:function(e,t,n){"use strict";var i=n(11),s=n(12),o=n(14),r=n(13),l=n(6),a=n.p+"static/media/spinner.fcb475bb.svg",c=n(0),d=function(e){Object(o.a)(n,e);var t=Object(r.a)(n);function n(e){var s;return Object(i.a)(this,n),(s=t.call(this,e)).text=window.elvisContext.plugin.messages,s}return Object(s.a)(n,[{key:"componentDidMount",value:function(){}},{key:"onCancel",value:function(){window.elvisContext.close()}},{key:"render",value:function(){return Object(c.jsx)("div",{style:{height:"100%"},children:Object(c.jsx)("div",{className:"center",children:Object(c.jsx)("img",{alt:"Working...",src:a})})})}}]),n}(l.Component);t.a=d},130:function(e,t,n){"use strict";n.r(t);var i=n(6),s=n.n(i),o=n(121),r=n.n(o),l=(n(135),n(122)),a=n(37),c=n(0);window.elvisContext=window.elvisContext||parent.elvisContext||parent.getElvisContext(window)||{},a.a.init(window.elvisContext.plugin.configProperties.api.value).then(r.a.render.bind(void 0,Object(c.jsx)(s.a.StrictMode,{children:Object(c.jsx)(l.a,{})}),document.getElementById("root")),(function(e){return alert(e)}))},135:function(e,t,n){},139:function(e,t){},141:function(e,t){},151:function(e,t){},153:function(e,t){},180:function(e,t){},181:function(e,t){},186:function(e,t){},188:function(e,t){},195:function(e,t){},214:function(e,t){},248:function(e,t,n){},37:function(e,t,n){"use strict";(function(e){var i=n(127),s=n.n(i),o=n(128),r=n.n(o),l=n(36),a=window.pluginSettings;t.a={serverUrl:"",resolvedLogin:null,_getFolderPath:function(){return window.elvisContext&&window.elvisContext.activeTab.folderSelection.length?window.elvisContext.activeTab.folderSelection[0].assetPath:"/"},_retrieveToken:function(){return fetch("/services/csrf",{credentials:"include"}).then((function(e){return e.json()}))},init:function(e){var t=this;return this.apiServerUrl=e,this._retrieveToken().then((function(e){var n=e.csrfToken;t.csrfToken=n;var i=n?{csrfToken:n}:{withCookie:!0};return t.folderPath=t._getFolderPath(),t.client=s.a.createClient(t.serverUrl),t.resolvedLogin=t.client.login(i),t.resolvedLogin})).catch((function(e){console.log(e)}))},waitForLogin:function(e){var t=this;return new Promise((function(n){t.resolvedLogin.then((function(){n(e())}))}))},search:function(e){return this.client.search(e)},sendInfo2:function(e){var t=new Request("".concat(this.apiServerUrl,"/api/movetotrash"),{method:"POST",body:JSON.stringify(e),headers:new Headers(this.getHeadersWithDefaults())});return fetch(t)},sendInfo:function(e){var t={server_url:a.server_url,username:a.username,password:a.password},n=this.encode(JSON.stringify(t),window.elvisContext.plugin.configProperties.key.value),i={headers:{"X-CSRF-TOKEN":this.csrfToken,"Content-Type":"application/json","X-Api-Key":a.api_key,trashpath:a.trashpath,iv:n.iv,details:n.content}};return r.a.post("".concat(this.apiServerUrl,"/movetotrash"),JSON.stringify(e),i)},encode:function(t,n){var i=l.randomBytes(16),s=l.createCipheriv("aes-256-ctr",n,i),o=e.concat([s.update(t),s.final()]);return{iv:i.toString("hex"),content:o.toString("hex")}},update:function(e,t){return this.client.update(e,t)}}}).call(this,n(4).Buffer)}},[[130,1,2]]]);
//# sourceMappingURL=main.35056087.chunk.js.map